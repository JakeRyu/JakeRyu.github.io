<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.18.0"/><style data-href="/styles.db05a864f5362495e721.css" data-identity="gatsby-global-css">body{font-family:Arial,Helvetica,sans-serif;font-size:17px;line-height:22px;margin:0}._404-module--content--OUNuJ{background-color:#fafafa;padding:20px}._404-module--content--OUNuJ ._404-module--header--FWmI-{color:red}._404-module--content--OUNuJ ._404-module--error-message--diUlb{color:gray;font-size:20px}.layout-module--container--RoCXy{min-height:100vh;position:relative}.layout-module--container--RoCXy .layout-module--content--FwTjf{margin:0 auto;max-width:960px;padding-bottom:100px}.layout-module--container--RoCXy .layout-module--content--FwTjf a{color:#000}@media screen and (min-width:1px)and (max-width:1000px){.layout-module--container--RoCXy .layout-module--content--FwTjf{padding-left:20px;padding-right:20px}}.header-module--container--i1m8L{margin:50px auto 0;max-width:960px;min-height:140px;padding-top:30px}.header-module--container--i1m8L .header-module--row--PMRLn{padding:5px;text-align:center}.header-module--container--i1m8L .header-module--button--MRlxv,.header-module--container--i1m8L .header-module--button-github--99DPx,.header-module--container--i1m8L .header-module--button-icon--lGaW9,.header-module--container--i1m8L .header-module--button-linkedin--bCjbJ,.header-module--container--i1m8L .header-module--button-twitter--a8R0i{background-color:#222f3e;color:#fff;display:inline-block;font-family:Verdana,Geneva,Tahoma,sans-serif;font-size:12px;font-weight:700;height:30px;line-height:30px;margin-bottom:10px;margin-right:10px;min-width:15px;padding-left:10px;padding-right:10px;text-transform:uppercase}.header-module--container--i1m8L .header-module--button--MRlxv:hover,.header-module--container--i1m8L .header-module--button-github--99DPx:hover,.header-module--container--i1m8L .header-module--button-icon--lGaW9:hover,.header-module--container--i1m8L .header-module--button-linkedin--bCjbJ:hover,.header-module--container--i1m8L .header-module--button-twitter--a8R0i:hover{background-color:#0984e3}.header-module--container--i1m8L .header-module--button-github--99DPx,.header-module--container--i1m8L .header-module--button-icon--lGaW9,.header-module--container--i1m8L .header-module--button-linkedin--bCjbJ,.header-module--container--i1m8L .header-module--button-twitter--a8R0i{background-position:50%;background-repeat:no-repeat;background-size:16px 16px}.header-module--container--i1m8L .header-module--button-github--99DPx{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfiChgMFzkb2YICAAAA6klEQVQoz42RP0oDcRhE3y8gaFIJplAhWgXcQJoFwT6VkCJlDpALeAALS8scwBPEK+gBTCGCf1hwYRU3zRYWhsTqWShBiKu+8mOYYb6Bv7Fr3+rStWrfLgTwloiCY+7ZZAvImbDHCRvchRZgYRkFVICsND0DbDordZjZxJG/MQpmNIArLnhnnRryxis1DomAJ5yq5wZj40XF2NgVL9UpJuoumJouBKkpuK8mFcZI/mOHHBhjRz34tP0eAfbUDuDQa3eWXt320SEEAAcc8UJCwZzAKnVa1DkNZ18CACPabLOGzHnmJjz8Y2eAD7/5vvjSJOIHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTEwLTI0VDEyOjIzOjU3KzAyOjAwzxYwVwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0xMC0yNFQxMjoyMzo1NyswMjowML5LiOsAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC)}.header-module--container--i1m8L .header-module--button-twitter--a8R0i{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfiChgMIBW5Bk7VAAAA0ElEQVQoz4WRvWoCYRRE5xN0GxEb0Wq1CIKdYGGRQlIL+ggW8YFWSJEUtr6AjaCihVVsBUMkEEgtdsE/ciyM+q2r7Cnv3Bkuc6UQTHBERlVF1TdfEgnh0CJmyRVWAKx5Y0BKPAET0ueFby4MaYg8AD80cSVy2LSPnv558EHHt1CTRJExf9zGPSYs7shLSYpIetbnzQpGp7sdXlgH/Bvy/wlmo7mcgN8zdi4luj7/lPhFTPLIKztL9qxuKdOzpF8m1APPIquCHrTVu2ZmH/bfKw47VepU/0v6uQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0xMC0yNFQxMjozMjoyMSswMjowMIhPuIoAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMTAtMjRUMTI6MzI6MjErMDI6MDD5EgA2AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==);margin-right:0}.header-module--container--i1m8L .header-module--button-linkedin--bCjbJ{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfiChgMHzpKCVmwAAAAi0lEQVQoz82QIQ7CQBBF3zYISBpO0XABDAaFQdaSIFZwoJ4DRYIjnAIcqoYKLAd4iJISsjQIDE9M/mT+/EwGV9buzenDWtXYN884Azzrx4Tc6JQfsKV6KYeu3Xn3aAGDZGPMgTkAC04uU0MkdHrEJksMgSslM24AlOkNjRMAq7ZNE7bh8v6oL/yD4QFJWUru4kp6/AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0xMC0yNFQxMjozMTo1OCswMjowMPwlT0MAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMTAtMjRUMTI6MzE6NTgrMDI6MDCNePf/AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg==)}.header-module--container--i1m8L .header-module--link--jOlJU{color:#222f3e;font-family:Verdana,Geneva,Tahoma,sans-serif;font-size:17px;font-weight:700;text-decoration:none}.header-module--container--i1m8L .header-module--link--jOlJU:hover{color:#0984e3}.header-module--container--i1m8L .header-module--link--jOlJU:not(:last-child){padding-right:30px}.footer-module--container--5GliC{background-color:#222f3e;bottom:0;height:100px;position:absolute;width:100%}.footer-module--container--5GliC .footer-module--footer--Z1xkR{color:#fff;font-family:Verdana,Geneva,Tahoma,sans-serif;height:100px;line-height:100px;margin:0 auto;max-width:960px;padding:0 20px}.title-module--container--mDD1t{border-bottom:5px solid #576574;color:#576574;margin-bottom:30px;padding-bottom:10px;text-align:center;text-transform:uppercase}.title-module--container--mDD1t .title-module--title--cbUG\+{font-size:50px;line-height:60px}.title-module--container--mDD1t .title-module--subtitle--DRZhF{font-size:18px;font-weight:100}.article-module--article-box--GvYiU{border-bottom:1px dotted #777;box-shadow:inset 0 0 0 0 #fff;display:inline-block;margin-bottom:30px;transition:all .25s ease;width:100%}.article-module--article-box--GvYiU:hover{cursor:pointer}@media screen and (min-width:960px){.article-module--article-box--GvYiU:hover{box-shadow:inset 960px 0 0 0 #dfe6e9}}.article-module--article-box--GvYiU .article-module--left--MCqTJ{background-color:#fafafa;float:left;height:150px;width:150px}.article-module--article-box--GvYiU .article-module--right--ddbwg{color:#222f3e;margin-left:150px;margin-top:-20px;padding:15px}.article-module--article-box--GvYiU .article-module--right--ddbwg .article-module--date--jFkoy{font-size:12px;margin-bottom:20px;margin-top:-15px}.article-module--article-box--GvYiU .article-module--right--ddbwg h3{color:#222f3e}.post-module--container--e01vr .post-module--content--tnGN8{padding:20px}.post-module--container--e01vr .post-module--content--tnGN8 h1{color:#222f3e;line-height:50px;margin-bottom:30px}.post-module--container--e01vr .post-module--content--tnGN8 h2{color:#576574;line-height:30px;margin-bottom:30px;margin-top:30px}.post-module--container--e01vr .post-module--content--tnGN8 h3{color:#576574;line-height:25px;margin-bottom:30px;margin-top:30px}.post-module--container--e01vr .post-module--content--tnGN8 p{font-size:18px;line-height:30px;margin-bottom:10px;text-align:justify}</style></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--RoCXy"><header class="header-module--container--i1m8L"><div class="header-module--row--PMRLn"><a href="/"><div class="header-module--button--MRlxv">Jake the dev</div></a><a href="https://www.github.com/jakeryu" target="_blank" rel="noopener noreferrer"><div class="header-module--button-github--99DPx"> </div></a><a href="https://www.linkedin.com/in/jakeryu" target="_blank" rel="noopener noreferrer"><div class="header-module--button-linkedin--bCjbJ"> </div></a><a href="https://twitter.com/jakeryu" target="_blank" rel="noopener noreferrer"><div class="header-module--button-twitter--a8R0i"> </div></a></div><div class="header-module--row--PMRLn"><a class="header-module--link--jOlJU" href="/">ARTICLES</a><a class="header-module--link--jOlJU" href="/about">ABOUT</a></div></header><div class="layout-module--content--FwTjf"><div class="post-module--container--e01vr"><div style="width:100%;height:640px;background-color:#fafafa;background-image:Url(https://picsum.photos/seed/database/960/640);background-size:cover;background-repeat:no-repeat;margin-bottom:30px"></div><section class="title-module--container--mDD1t"><h1 class="title-module--title--cbUG+">Get the repository pattern right</h1><div class="title-module--subtitle--DRZhF"></div></section><div class="post-module--content--tnGN8"><p>The well-known patterns, repository and unit of work patterns lie at the heart of the persistence layer. A repository usually provides CRUD functions on a database entity. In order not to repeat the same tasks across all entities, a generic repository comes in the picture.</p>
<!--more-->
<h2>Generic Repository</h2>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">public interface IRepository&lt;T, I&gt; where T : IEntity where I : struct
{
    Task&lt;T&gt; GetByIdAsync(I id);
    IPagedList&lt;T&gt; GetPagedListAsync(PageInfo pageInfo);
    Task AddAsync(T entity);
    void Delete(T entity);
}</code>
        </deckgo-highlight-code>
<p>If it is a common function to be shared by all entities, the generic repository is the centralised place to put it. The generic repository takes any classes which implement <code>IEntity</code> where <code>Id</code> property is defined. If you use Entity Framework, this is essential. The <code>Id</code> can be a type of <code>int</code> or <code>GUID</code> depending on your scenario. Thus, <code>I</code> is a generic type for <code>Id</code>.</p>
<p><code>Repository</code> class is an implementation of <code>IRepository</code>. A database context gets injected through the constructor, which is likely to be Entity Framework <code>DbContext</code>. What the repository does is to handle <code>DbSet</code> of an entity for basic CRUD actions.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">public class Repository&lt;T, I&gt; : IRepository&lt;T, I&gt; where T : Entity where I : struct
{
    private readonly AdserveContext context;
    
    public Repository(AdserveContext context)
    {
        this.context = context;
    }
    
    public async Task&lt;T&gt; GetByIdAsync(I id)
    {
        var entity = await context.Set&lt;T&gt;().FindAsync(id);
        if(entity == null) throw new EntityNotFoundException(typeof(T).Name, id);
        
        return entity;
    }

    public async Task AddAsync(T entity) =&gt; await context.Set&lt;T&gt;().AddAsync(entity);

    public async IPagedList&lt;T&gt; GetPagedListAsync(PageInfo pageInfo)
    {
        var page = pageInfo ?? PageInfo.UseDefault();
        return await context.Set&lt;T&gt;().ToPagedListAsync(page.Number, page.Size);
    }

    public void Delete(T entity) =&gt; context.Set&lt;T&gt;().Remove(entity);
}</code>
        </deckgo-highlight-code>
<h2>Domain repository</h2>
<p>Domain repository is the one you will use in your code. Looking at the inheritance hierarchy, it implements its own interface and inherits the generic repository.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/aba3eed301b7ebe6c08f221d7015de13/5df5d/repository-inheritance-hierarchy.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABk0lEQVQ4y31T14oCQRC8//8sFRVBBOODCXOcTW401VF99DDuqQ2lzEx3dar9AYDH44Hr9Yrn88mj/PPMez27b59A++GPH4SI4wTT6RTdbhez2QxFUSBN07dBn4zvQhiGIfI8x2AwQLVaRa/XQ5Zl8H3/X9DtdkOSJILdbgdjjCQmbIWHwwGdTkfQ7/exWq0QRRG22y0ul4slYFAQBDidTpK0Uqmg2WxiuVyKnyX0PA/tdhutVkvItTWScI5uy/f7XYLjOMZ+v8f5fJbk7MgS8pEPbJ1t8EyQ8JuxYi7vZYblQTO7btd1LG+ZxqqU8GXLbkus7J1cyn5aIdXgvtkKlaSc8Zts3E5eKjSehyRJsV6vMRwOsdlsZH66OdeCMMLxeMR4PBbf0WgkcZw/JSWE3NZkMpFN12o1kQ6XRGLOiRoVZJnozhgP8/lcPgBC9cju/io0Bo1GA/V6HYvFws5FBU9HgvcUe5HnIh8XvLeEDKQ4WTpb1c+OCyob35mElSvoz/HYljlchVZDMHN522UfBcm45V825jwx3rnTlQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Repository Interface Hierarchy"
        title="Repository Interface Hierarchy"
        src="/static/aba3eed301b7ebe6c08f221d7015de13/5a190/repository-inheritance-hierarchy.png"
        srcset="/static/aba3eed301b7ebe6c08f221d7015de13/772e8/repository-inheritance-hierarchy.png 200w,
/static/aba3eed301b7ebe6c08f221d7015de13/e17e5/repository-inheritance-hierarchy.png 400w,
/static/aba3eed301b7ebe6c08f221d7015de13/5a190/repository-inheritance-hierarchy.png 800w,
/static/aba3eed301b7ebe6c08f221d7015de13/c1b63/repository-inheritance-hierarchy.png 1200w,
/static/aba3eed301b7ebe6c08f221d7015de13/5df5d/repository-inheritance-hierarchy.png 1572w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Having its own interface <code>IDomainRepository</code> allows to extend its function further than what the generic repository offers. You can declare more functions there which should be specific to the repository.</p>
<p>The diagram above does not define any domain-specific function; we call it a  dumb repository. It is because the generic implementation inherited from <code>Repository</code> class is just good enough.</p>
<p>Below is a sample code to retrieve a paged list of sites. Unit of work is what you need.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">[ApiController]
[Route(&quot;api/[controller]&quot;)]
public class SiteController : ControllerBase
{
    private readonly IUnitOfWork uow;

    public SiteController(ILogger&lt;StationController&gt; logger, IUnitOfWork unitOfWork)
    {
        uow = unitOfWork;
    }

    [HttpGet(&quot;all&quot;)]
    public async Task&lt;IActionResult&gt; GetAll()
    {
        var sites = await uow.Sites.GetPagedListAsync();
        if (sites.Count == 0) return NotFound();
        
        return Ok(sites);
    }
}</code>
        </deckgo-highlight-code>
<h2>Unit of work</h2>
<p>One of the common mistakes of using the repository pattern is that people implement a save method inside the repository while the repository should work as a collection. Adding an entity, modifying it and removing it are the responsibility of the collection, but it doesn't save itself. Unit of work is a container of all repositories and instantiates them in it. Thus, a repository is obtained via the unit of work, and it saves all changes across multiple repositories in a transaction.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3cf3c2c84113cd99aeca5ea39731cac1/7970d/unit-of-work.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXElEQVQoz5WSW6uCQBSF/f//yB57iEKpkMoLEVEGRV4q75auw9rnjJicC2dg4YzOfLP2cmsA8Hq9kGUZ6roW5Xku7zjatsV/hqaAQRDANE0sFgs8Hg9UVdUBFVTNf1MHDMMQq9UKy+UScRzj+Xy+Oew7Hbrur7WfrA9dcTCOIIxQFAVOpxM2m408y7KUqmhC46YwihFFETzPE91uty7TPryQg4nMGdHxeMT5fBbQ/X6X/RqzStNMbtJ1HaPRCJfLRVxQfSAPuq6L8XiM2WyG3W4n78mgQwE2TYP1eo3pdArDMLDdbiXTNE0lS/5xzglnzizTsizJmnCeV1AB8tbD4SCuaJ/iRwKYzVvJX1CWRzEarq/Xq6gD7vd7uc1xHNi2LS7prt86qhtY5mQykRabz+dyhiYI53eNmwn9TsOWoQNWw4h83xeX6u8mSfLp8K/OHzY2XagnRRgrodjYH+7rTsgJXpCNAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Unit of work"
        title="Unit of work"
        src="/static/3cf3c2c84113cd99aeca5ea39731cac1/5a190/unit-of-work.png"
        srcset="/static/3cf3c2c84113cd99aeca5ea39731cac1/772e8/unit-of-work.png 200w,
/static/3cf3c2c84113cd99aeca5ea39731cac1/e17e5/unit-of-work.png 400w,
/static/3cf3c2c84113cd99aeca5ea39731cac1/5a190/unit-of-work.png 800w,
/static/3cf3c2c84113cd99aeca5ea39731cac1/c1b63/unit-of-work.png 1200w,
/static/3cf3c2c84113cd99aeca5ea39731cac1/29007/unit-of-work.png 1600w,
/static/3cf3c2c84113cd99aeca5ea39731cac1/7970d/unit-of-work.png 1908w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Unit of work hides <code>DbContext</code> as developers are not expected to directly use it. Note that the constructor expects a <code>DbContext</code>. It is important to have an instance of the context before creating an instance of the unit of work.</p>
<p>The unit of work wraps the context and control the repositories as below.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">public class UnitOfWork : IUnitOfWork
{
    private readonly ApplicationContext context;
    public ISiteRepository Sites { get; }
    public ICampaignRepository Campaigns { get; }

    public UnitOfWork(ApplicationContext context)
    {
        this.context = context;

        Sites = new SiteRepository(context);
        Campaigns = new CampaignRepository(context);
    }
    
    public Task&lt;int&gt; SaveChangesAsync()
    {
        return context.SaveChangesAsync();
    }

    public void Dispose()
    {
        context?.Dispose();
    }
}</code>
        </deckgo-highlight-code>
<p>Following code is extracted from a unit test. Don’t forget to call <code>SaveChangesAsync()</code> in the end of the process unless you want to lose the changes.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">using var uow = new UnitOfWork(AdserveContextFactory.Create());
var entity = await uow.Stations.GetByIdAsync(stationId);

uow.Stations.Delete(entity);
await uow.SaveChangesAsync();</code>
        </deckgo-highlight-code>
<h2>Aggregate root</h2>
<p>Think the number of database tables. If each table happens to be an individual repository, the unit of work is bombarded with repositories. It also doesn't look logical to work on Order and LineItem, for example, with OrderRepository and LineItemRepository respectively. LineItem can be accessed and managed through the Order.</p>
<p>Aggregate root encapsulates a primary entity with child entities and is exposed to the unit of work. It not only reduces the number of repository also, makes functions more complete with associated entities.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b5cb35731f88a7e0b680cfbddeefb3b2/81ebd/aggregate-root.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoElEQVQ4y3WT14rCYBCFff93Ui8EwYK9gXqhoFgTN7bEdpZv1pEo68CQv5z/TDmTTJJcdDqddDgctN/vbZ0kiR6PhzkWJ4mOx6PiODYHh4Njfz6fdb1eDZv5iSJFUaRCoaBsNqvFYmGk9/tdbgTjETYejw2Xy+U0nU7tjDsCGuFut9NoNNJgMNBwONR2u9VqtTISopMFZ71eT51OR41GQ7VaTc1mU61WS91u14KQsRGGYah8Pq9yuWwPKZNoEN1uN9sDhqRYLKper6tarapSqRghCYHzCjJkET3LhhwiSvb+WQ/j2DImEHfggiAwksvlTwMwRuiP6Jn3wc1J+XKPs+YxWPaI4ZUYoS/SaacVTmeaNvCfBjaTJqDc9N7Jzs9xIRtKp9fr9drWlMwd39fY4CiNkvQHYNrWm43m87mRtNttExBhmArwTAXiGGEQhiY7ZP1+36Ivl0tT1gc5DAMjnEwmms1mJoj3jazBIMzb2JRKJcsA87/AhaC333rpLXqpDBhSJ2H/OTbs6RHkZJZ2znzU3sbmW2TMZ41g/7kHhPAXaqnnvfC8fxcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Aggregate root"
        title="Aggregate root"
        src="/static/b5cb35731f88a7e0b680cfbddeefb3b2/5a190/aggregate-root.png"
        srcset="/static/b5cb35731f88a7e0b680cfbddeefb3b2/772e8/aggregate-root.png 200w,
/static/b5cb35731f88a7e0b680cfbddeefb3b2/e17e5/aggregate-root.png 400w,
/static/b5cb35731f88a7e0b680cfbddeefb3b2/5a190/aggregate-root.png 800w,
/static/b5cb35731f88a7e0b680cfbddeefb3b2/c1b63/aggregate-root.png 1200w,
/static/b5cb35731f88a7e0b680cfbddeefb3b2/29007/aggregate-root.png 1600w,
/static/b5cb35731f88a7e0b680cfbddeefb3b2/81ebd/aggregate-root.png 1868w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>A diagram above shows an aggregate repository for Station that encapsulates SalesHouse. <code>IStationRepository</code> is not a dumb repository here; it defines some additional functions on behalf of SalesHouse entity.</p>
<p>While StationRepository still inherits the generic repository capabilities, there is a case that it needs to override a generic implementation.</p>
<p>Use <code>new</code> keyword to hide the default behaviour.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">// StationRepository.cs
public new async Task&lt;Station&gt; GetByIdAsync(int id)
{
    var station = await context.Stations
        .Include(s =&gt; s.SalesHouse)
        .SingleOrDefaultAsync(s =&gt; s.Id == id);
    
    if (station == null) throw new EntityNotFoundException(&quot;Station&quot;, id);
    
    return station;
}</code>
        </deckgo-highlight-code>
<p>The code above hides the default behaviour from <code>Repository.cs</code> below. For aggregate root, it is likely to be fetched with its child objects so it returns an object graph.</p>
<deckgo-highlight-code language="csharp" terminal="carbon" theme="one-light" line-numbers="true"  >
          <code slot="code">// Repository.cs
public async Task&lt;T&gt; GetByIdAsync(I id)
{
    var entity = await context.Set&lt;T&gt;().FindAsync(id);
    if(entity == null) throw new EntityNotFoundException(typeof(T).Name, id);
    
    return entity;
}</code>
        </deckgo-highlight-code></div></div></div><footer class="footer-module--container--5GliC"><div class="footer-module--footer--Z1xkR">My new Gatsby Blog 2019</div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/repository-pattern/";window.___webpackCompilationHash="33fb21b6b22b0e380d2d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-82df740e7cad994d0af0.js"],"app":["/app-0c385512a1f64cc6d7f4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0e83c4e916c6a584f6a1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-236d410604323c4aaa79.js"],"component---src-pages-index-js":["/component---src-pages-index-js-740cf792298a614a522c.js"],"component---src-templates-post-js":["/component---src-templates-post-js-8b3119005e232a8c0f47.js"]};/*]]>*/</script><script src="/polyfill-82df740e7cad994d0af0.js" nomodule=""></script><script src="/app-0c385512a1f64cc6d7f4.js" async=""></script><script src="/framework-ece53a4dfa3f421a9587.js" async=""></script><script src="/webpack-runtime-ac1ba28d15bf0e2ece1e.js" async=""></script></body></html>
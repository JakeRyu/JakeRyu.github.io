{"componentChunkName":"component---src-templates-post-js","path":"/api-versioning/","result":{"data":{"markdownRemark":{"html":"<p>Microsoft has provided a Nuget package called <code>Microsoft.AspNetCore.Mvc.Versioning</code> to ease the process versioning .Net Core REST APIs. With the package installed, configure the default behaviour for API versioning.</p>\n<!--more-->\n<deckgo-highlight-code language=\"csharp\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// Startup.cs\r\nservices.AddApiVersioning(config =&gt;\r\n{\r\n    config.DefaultApiVersion = new ApiVersion(1, 0);\r\n    config.AssumeDefaultVersionWhenUnspecified = true;\r\n    config.ReportApiVersions = true;\r\n    config.ApiVersionReader = new HeaderApiVersionReader(&quot;X-Version&quot;);\r\n});</code>\n        </deckgo-highlight-code>\n<p>Specify the default API version as 1.0 and use the version if the client hasn’t specified the API version in the request. To advertise the available versions, set the ReportApiVersions property to true. Then, the client gets a response header, <code>api-supported-versions</code> with the versions.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/e2d3b/api-supported-versions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQoz4WR0QrDIAxF+/8/ORjsZTA6NcZoa++4GV3LWDshGMrx5GqHGCOSCCQ88bheEO43ZEng92qGaZrQWvNin1JC1IRkglIL1BTZFKLZ94GQ5IxlWd7V+9Z/FReFRRVTa7BiMDMsfWOG3jtyziilYJ5nP3QmJBdCQEzRe1bfhXAhp47j6DsT/5Kth0TEhXyCde05F64Q4/c/V17ZI8aFqopa6yG0F5Ll4KOn+Qj5Vzmd/VlKDuZ1jxK+ALQ2Jn6lfB/fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"api-supported-versions.png\"\n        title=\"api-supported-versions.png\"\n        src=\"/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/5a190/api-supported-versions.png\"\n        srcset=\"/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/772e8/api-supported-versions.png 200w,\n/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/e17e5/api-supported-versions.png 400w,\n/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/5a190/api-supported-versions.png 800w,\n/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/c1b63/api-supported-versions.png 1200w,\n/static/ffa0ce9fe54c2c9f35232f8fd5b860b8/e2d3b/api-supported-versions.png 1466w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Version specific Controllers and Actions</h2>\n<p>When the clients make request for a specific version of an API endpoint, the request should be redirected to the appropriate controller or action handling the requested API version. There are multiple approaches on how to assign controllers and actions to handle version specific requests.</p>\n<p>Separate controllers can be created for each API versions and the request will be directed to a particular controller based on the requested API version. However, to keep it simple we use a single controller with multiple versions.</p>\n<deckgo-highlight-code language=\"csharp\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">[ApiVersion(&quot;1.0&quot;)]\r\n[ApiVersion(&quot;1.1&quot;)]\r\n[ApiController]\r\n[Route(&quot;[controller]&quot;)]\r\npublic class JakeController : ControllerBase\r\n{\r\n    [HttpGet(&quot;{id}&quot;)]\r\n    [MapToApiVersion(&quot;1.0&quot;)]\r\n    public async Task&lt;IActionResult&gt; Get(int id)\r\n    {\r\n        var command = new GetJakeCommand {Id = id};\r\n        var result = await mediator.Send(command);\r\n\r\n        return Ok(result);\r\n    }\r\n\r\n    [HttpGet(&quot;{id}&quot;)]\r\n    [MapToApiVersion(&quot;1.1&quot;)]\r\n    public async Task&lt;IActionResult&gt; GetV1_1(int id)\r\n    {\r\n        var command = new GetJakeCommand {Id = id};\r\n        var result = await mediator.Send(command);\r\n\r\n        return Ok(result);\r\n    }\r\n}</code>\n        </deckgo-highlight-code>\n<p>If an action has no <code>MapToApiVersion</code> attribute, it’s assumed to have the default version of 1.0. C# doesn’t allow to have the same method name with the same signature so the method name should be different.</p>\n<h2>Versioning Strategies</h2>\n<p>Now that the API supports multiple version, we need a way to allow clients to specify the API version they are requesting. There are few different approaches on how to allow clients to send the versioning information when making the request.</p>\n<h3>Using query params</h3>\n<p>The default versioning scheme provided by the Microsoft.AspNetCore.Mvc.Versioning package makes use of a query param <code>api-version</code>.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">https://{domain}/api/controller?api-version=1.1</code>\n        </deckgo-highlight-code>\n<p>My API requires, in some cases, the query string to provide the paging details and search criteria. Adding more element to the query string may increase the complexity of composing a request.</p>\n<h3>Using request headers</h3>\n<p>Another approach to versioning an API is using request headers where a header value specifies the API version. Unlike the URL path param and query string approach, using request header doesn't require fiddling around with the URLs on the client side. The downside to using request headers for versioning is that the versioning option is not explicitly visible to the client at a first glance.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/146c95f012509e4a1d109c17d7da048d/1c1a4/x-version.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVQY021PXQuDMBDr//9/gm9DGKMP2mprq/2wGTlQcLMQmiO53J1a1xXLsiClBO+9cGLfdxhjoLWG8bPU1lrEGMEe8nme5d+2TXoJFULANE3S4JyTkMV51C0gfgb49wtRDyjOYk8JJWfknCXkRClFFiIUC05kIEVyCrfXgNaagP7jOO5yaxdXtVZZlYG/phsA0DuO4+X987QG1fc9uq4DT+fJnE48mRnI7Z+0M/ALxyOGFjTFrtUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"x-version\"\n        title=\"x-version\"\n        src=\"/static/146c95f012509e4a1d109c17d7da048d/5a190/x-version.png\"\n        srcset=\"/static/146c95f012509e4a1d109c17d7da048d/772e8/x-version.png 200w,\n/static/146c95f012509e4a1d109c17d7da048d/e17e5/x-version.png 400w,\n/static/146c95f012509e4a1d109c17d7da048d/5a190/x-version.png 800w,\n/static/146c95f012509e4a1d109c17d7da048d/1c1a4/x-version.png 1046w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Using media type (Accept header)</h3>\n<p>Another approach of version the API is using the content negotiation process provided by HTTP. When client requests a resource using the Accept header, they could explicitly include the version number in the media type itself.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">GET /resource/4\r\nAccept: application/json;v=1.1</code>\n        </deckgo-highlight-code>\n<p>Server could read the Accept header and respond with the appropriate API version. It’s like a header recycle to see the bright side. A disadvantage is that it is obscure, difficult to implement and not immediately obvious to clients that they can request different API versions using the Accept header.</p>\n<h3>Using URL path</h3>\n<p>Using a version number directly in the URL path is one of the simplest way of versioning an API. URL path versioning approach is more visible since it explicitly states the version number in the URL itself. However, this approach mandates clients to change their URL across their application whenever there is a new API version. Furthermore, embedding the API version into the URL itself would break a fundamental principle of REST API which states that each URL should represent a particular resource and the resource URL should not change over time. This approach is better suited in cases when every new API version has broad major changes.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">https://{domain}/api/v1.1/resource</code>\n        </deckgo-highlight-code>\n<h2>Supporting multiple versioning</h2>\n<p>It is possible to support multiple API versioning schemes to provide flexibility and give options to the clients to use the versioning scheme of their choice.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">config.ApiVersionReader = ApiVersionReader.Combine(new HeaderApiVersionReader(&quot;X-Version&quot;), new QueryStringApiVersionReader(&quot;api-version&quot;));</code>\n        </deckgo-highlight-code>\n<h2>Advertising the deprecated versions</h2>\n<p>Similar to advertising the supported API versions for an endpoint, API versions which will be deprecated in the near future can also be advertised by setting the deprecated property to true in the ApiVersion attribute. The client could read the <code>api-deprecated-versions</code> in the response header and identify the deprecated API versions.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">[ApiVersion(&quot;1.0&quot;, Deprecated = true)]\r\n[ApiVersion(&quot;1.1&quot;)]\r\n[ApiController]\r\n[Route(&quot;[controller]&quot;)]\r\npublic class JakeController : ControllerBase\r\n{\r\n   ...\r\n}</code>\n        </deckgo-highlight-code>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c0450fef1b1f5d8f4b191779e40a3107/d7e70/api-deprecated-versions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQoz41R7QqDMBDr+7/jYH/Gxhj9srVqPzLScUNFNoUQe97FXKqccxiGAWR9v+FxvcCbJ7z30FpjHEcsy4J5njdMcE4HCxsdYoh4DRqqlIIQAsglReTgO9dae428R2ut/zCl1N9bbZ96bVAsUHCaJvBpAjb+AJ1TlC5jjF2DrOQjVxan/8QIDltrIZFRnPNfh2zIOZ8SkxlCopF41Nr+uunsyvv6ZmVCwv4nyts+2qgLMgNjTM+E4PmM4FHPG93tc3ruLzvGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"api-deprecated-versions\"\n        title=\"api-deprecated-versions\"\n        src=\"/static/c0450fef1b1f5d8f4b191779e40a3107/5a190/api-deprecated-versions.png\"\n        srcset=\"/static/c0450fef1b1f5d8f4b191779e40a3107/772e8/api-deprecated-versions.png 200w,\n/static/c0450fef1b1f5d8f4b191779e40a3107/e17e5/api-deprecated-versions.png 400w,\n/static/c0450fef1b1f5d8f4b191779e40a3107/5a190/api-deprecated-versions.png 800w,\n/static/c0450fef1b1f5d8f4b191779e40a3107/c1b63/api-deprecated-versions.png 1200w,\n/static/c0450fef1b1f5d8f4b191779e40a3107/d7e70/api-deprecated-versions.png 1286w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Conclusion</h2>\n<p>My chosen API versioning scheme is using request headers. It doesn’t pollute the URL and doesn’t share a request header.</p>\n<p>A customer header <code>X-Version</code> is used to specify the API version.</p>","frontmatter":{"title":"API Versioning","keywords":"version"}}},"pageContext":{"slug":"/api-versioning/"}},"staticQueryHashes":["3159585216"]}